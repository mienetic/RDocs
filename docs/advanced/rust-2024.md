# Rust 2024 Edition

ฟีเจอร์ใหม่ใน Rust 2024 Edition (เริ่มใช้ตั้งแต่ Rust 1.85+)!

## Edition คืออะไร?

Rust Editions คือ "checkpoint" ของภาษาที่อนุญาตให้มี breaking changes

| Edition | ปี | ฟีเจอร์หลัก |
|---------|-----|-----------|
| 2015 | 2015 | เริ่มต้น |
| 2018 | 2018 | async/await, NLL |
| 2021 | 2021 | IntoIterator for arrays |
| 2024 | 2024 | async traits, gen keyword |

:::tip ใช้ Edition ใหม่ได้เลย!
Editions เข้ากันได้ - crate ที่ใช้ edition เก่าสามารถใช้กับ crate edition ใหม่ได้
:::

## ตั้งค่า Edition 2024

```toml
# Cargo.toml
[package]
name = "my_project"
version = "0.1.0"
edition = "2024"  # <- เปลี่ยนตรงนี้!
```

## Async Closures

### ก่อน 2024

```rust
// ต้องใช้ async block
let closure = |x| async move {
    x * 2
};

// เรียกใช้
let result = closure(5).await;
```

### Rust 2024

```rust
// async closure โดยตรง!
let closure = async |x| {
    x * 2
};

// เรียกใช้
let result = closure(5).await;
```

<RustPlayground>

```rust
fn main() {
    // แสดง concept ของ async closures
    // (ต้องใช้ runtime เพื่อ execute จริง)
    
    println!("Rust 2024 allows async closures:");
    println!("  async |x| {{ ... }}");
    println!("");
    println!("Instead of:");
    println!("  |x| async move {{ ... }}");
}
```

</RustPlayground>

## Async Traits

### ก่อน 2024 (ต้องใช้ async-trait crate)

```rust
use async_trait::async_trait;

#[async_trait]
trait Database {
    async fn query(&self, sql: &str) -> Vec<Row>;
}

#[async_trait]
impl Database for PostgreSQL {
    async fn query(&self, sql: &str) -> Vec<Row> {
        // ...
    }
}
```

### Rust 2024 (built-in!)

```rust
// ไม่ต้องใช้ crate เพิ่ม!
trait Database {
    async fn query(&self, sql: &str) -> Vec<Row>;
}

impl Database for PostgreSQL {
    async fn query(&self, sql: &str) -> Vec<Row> {
        // ...
    }
}
```

## Unsafe Extern Blocks

### ก่อน 2024

```rust
extern "C" {
    fn external_function();  // implicitly unsafe
}

fn main() {
    unsafe {
        external_function();
    }
}
```

### Rust 2024

```rust
// ต้องระบุ unsafe หรือ safe ชัดเจน
unsafe extern "C" {
    // unsafe function
    unsafe fn dangerous_function();
    
    // safe function (มี contract ที่ปลอดภัย)
    safe fn safe_external();
}

fn main() {
    // unsafe function ต้องอยู่ใน unsafe block
    unsafe {
        dangerous_function();
    }
    
    // safe function เรียกได้ตรงๆ
    safe_external();
}
```

## gen Keyword Reserved

`gen` ถูกสงวนไว้สำหรับ generators ในอนาคต

<RustPlayground>

```rust
fn main() {
    // gen เป็น reserved keyword ใน 2024
    // ใช้เป็นชื่อตัวแปรไม่ได้!
    
    // let gen = 5;  // ERROR ใน 2024!
    
    // ใช้ raw identifier แทน
    let r#gen = 5;
    println!("r#gen = {}", r#gen);
    
    // หรือใช้ชื่ออื่น
    let generator = 5;
    println!("generator = {}", generator);
}
```

</RustPlayground>

### Generators (อนาคต)

```rust
// อาจจะมาในอนาคต
gen fn fibonacci() -> impl Iterator<Item = u64> {
    let mut a = 0;
    let mut b = 1;
    loop {
        yield a;
        (a, b) = (b, a + b);
    }
}
```

## Never Type Fallback

Rust 2024 เปลี่ยน fallback type ของ `!` (never type):

```rust
// Expression ที่ไม่ return (diverging)
fn never_returns() -> ! {
    loop {}
}

// ใน 2021: ! fallback เป็น ()
// ใน 2024: ! ยังคงเป็น !

let x = if condition {
    42
} else {
    panic!("error")  // ! type
};
// x: i32
```

## Improved Lifetime Handling

### RPIT Lifetime Capture

```rust
// Return Position Impl Trait (RPIT)
fn process(data: &str) -> impl Iterator<Item = char> + '_ {
    data.chars()
}

// Rust 2024 captures lifetime อัตโนมัติในบางกรณี
fn process2024(data: &str) -> impl Iterator<Item = char> + use<'_> {
    data.chars()
}
```

## FromIterator for Pairs

สร้าง collection จาก pairs ง่ายขึ้น:

<RustPlayground>

```rust
use std::collections::HashMap;

fn main() {
    // Array of tuples to HashMap
    let pairs = [("a", 1), ("b", 2), ("c", 3)];
    
    let map: HashMap<_, _> = pairs.into_iter().collect();
    println!("{:?}", map);
    
    // Vec of tuples
    let vec: Vec<(_, _)> = [("x", 10), ("y", 20)].into_iter().collect();
    println!("{:?}", vec);
}
```

</RustPlayground>

## เปรียบเทียบ Edition Features

| Feature | 2015 | 2018 | 2021 | 2024 |
|---------|------|------|------|------|
| NLL | No | Yes | Yes | Yes |
| async/await | No | Yes | Yes | Yes |
| Edition resolver | 1 | 2 | 2 | 2 |
| IntoIterator for arrays | No | No | Yes | Yes |
| async closures | No | No | No | Yes |
| async traits | No | No | No | Yes |
| gen reserved | No | No | No | Yes |
| unsafe extern | Optional | Optional | Optional | Required |

## Migration

### Automatic Migration

```bash
# อัปเดต edition อัตโนมัติ
cargo fix --edition

# ตรวจสอบก่อนอัปเดต
cargo fix --edition --allow-dirty --allow-staged
```

### Common Migration Issues

1. **gen as identifier** - เปลี่ยนเป็น `r#gen` หรือชื่ออื่น
2. **unsafe extern** - เพิ่ม `unsafe` หรือ `safe`
3. **RPIT lifetimes** - ใช้ `use<'_>` syntax

## Rust 1.92.0 Features

นอกจาก Edition 2024 ยังมีฟีเจอร์ใหม่จาก Rust 1.92.0:

<RustPlayground>

```rust
fn main() {
    // ตัวอย่างฟีเจอร์จาก Rust versions ล่าสุด
    
    // Let chains (stable ใน 1.76)
    let x = Some(5);
    if let Some(n) = x && n > 3 {
        println!("n = {} และมากกว่า 3", n);
    }
    
    // Inline const (stable ใน 1.79)
    let v = [const { Vec::new() }; 3];
    println!("3 empty vecs: {:?}", v);
    
    // Lazy type aliases (stable ใน recent versions)
    type MyVec = Vec<String>;
    let names: MyVec = vec!["Rust".to_string()];
    println!("{:?}", names);
}
```

</RustPlayground>

## สรุป

| Feature | คำอธิบาย |
|---------|---------|
| Async closures | `async \|x\| { ... }` |
| Async traits | ไม่ต้องใช้ async-trait crate |
| gen reserved | เตรียมสำหรับ generators |
| Unsafe extern | ต้องระบุ safe/unsafe |
| RPIT capture | `use<'_>` syntax |

**ยินดีด้วย!** คุณจบหลักสูตร Rust ฉบับไทยครบแล้ว!

---

[กลับหน้าแรก](/)
